<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>Checked Out | Southold Free Library</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Merriweather:wght@300;400;700&family=Playfair+Display:wght@400;700&family=Poppins:wght@300;400;500;600&display=swap');

    * { box-sizing: border-box; }
    body {
      font-family: 'Poppins', Arial, sans-serif;
      max-width: 600px; margin: 0 auto; padding: 20px;
      background: #f5f5f5; min-height: 100vh;
    }
    .header {
      text-align: center; margin-bottom: 20px;
      background: linear-gradient(135deg, rgba(139,195,74,.05), rgba(52,152,219,.05));
      border: 1px solid rgba(52,152,219,.1); padding: 20px; border-radius: 10px;
      box-shadow: 0 2px 4px rgba(0,0,0,.1);
    }
    h1 {
      font-family: 'Merriweather', serif; font-size: 2.8rem; font-weight: 700;
      background: linear-gradient(135deg,#8bc34a,#3498db);
      -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
      margin: 0 0 10px 0; letter-spacing:-.02em;
    }
    .subtitle { font-family:'Playfair Display',serif; font-style: italic; color:#666; font-size:1.1rem; margin:0; }
    .date-info {
      background: linear-gradient(135deg, rgba(139,195,74,.1), rgba(52,152,219,.1));
      border: 1px solid rgba(52,152,219,.2); padding: 15px; border-radius: 8px; margin: 15px 0; text-align: center;
    }
    .game-number {
      font-weight: 600;
      background: linear-gradient(135deg,#8bc34a,#3498db);
      -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; font-size:1.1rem;
    }

    .stats-row {
      display: flex; justify-content: center; gap: 10px; margin: 15px 0; flex-wrap: wrap;
    }
    .stats-container, .theme-hint {
      background:white; border:1px solid rgba(52,152,219,.2); border-radius:6px; padding:10px 15px;
      text-align:center; box-shadow:0 1px 3px rgba(0,0,0,.1); min-width: 120px;
    }
    .theme-hint {
      font-size:.9rem; color:#1f2937; font-weight:500;
    }
    .streak-display { font-size:1rem; font-weight:600; color:#1f2937; }

    .container {
      background:white; padding:20px; border-radius:10px; margin-bottom:15px; box-shadow:0 2px 4px rgba(0,0,0,.1);
    }

    .clue {
      background: linear-gradient(135deg, rgba(139,195,74,.08), rgba(52,152,219,.08));
      border:1px solid rgba(52,152,219,.2); padding:15px; margin:10px 0; border-left:4px solid #3498db; border-radius:5px;
    }

    .guess { padding:12px; margin:8px 0; border-radius:8px; font-weight:500; }
    .correct { background: linear-gradient(135deg, rgba(139,195,74,.15), rgba(139,195,74,.1)); border:2px solid #8bc34a; color:#2e7d32; }
    .incorrect { background:#fef2f2; border:2px solid #dc2626; color:#991b1b; }
    .skipped { background:#f3f4f6; border:2px solid #d1d5db; color:#6b7280; font-style: italic; }

    .input-group { display:flex; gap:10px; align-items:center; margin-top:15px; }
    input[type="text"] {
      flex:1; padding:12px; border:2px solid #d1d5db; border-radius:8px; font-size:16px; font-family:'Poppins',sans-serif;
    }
    input[type="text"]:focus { outline:none; border-color:#2563eb; }
    button {
      padding:12px 20px; background: linear-gradient(135deg,#8bc34a,#3498db); color:white; border:none; border-radius:8px; cursor:pointer;
      font-size:16px; font-weight:500; font-family:'Poppins',sans-serif;
    }
    button:hover { background: linear-gradient(135deg,#7cb342,#2980b9); }
    .skip-btn { background:#dc2626; min-width:50px; font-size:18px; padding:12px; }
    .skip-btn:hover { background:#b91c1c; }
    .submit-btn { min-width:50px; font-size:18px; padding:12px; }

    .result { text-align:center; padding:25px; border-radius:10px; margin:20px 0; font-size:1.1rem; font-weight:500; }
    .win { background:#dcfce7; color:#166534; border:2px solid #16a34a; }
    .lose { background:#fef2f2; color:#991b1b; border:2px solid #dc2626; }

    .stats-summary {
      background: linear-gradient(135deg, rgba(139,195,74,.08), rgba(52,152,219,.08));
      border: 1px solid rgba(52,152,219,.2); border-radius: 8px; padding: 15px; margin: 15px 0;
      display: grid; grid-template-columns: repeat(auto-fit, minmax(80px, 1fr)); gap: 15px; text-align: center;
    }
    .stat-number { font-size: 1.5rem; font-weight: 700; color: #1f2937; }
    .stat-label { font-size: .8rem; color: #6b7280; text-transform: uppercase; }

    .share-button { background:#10b981; margin:5px; }
    .share-button:hover { background:#059669; }
    .native-share-btn { background: #3b82f6; margin:5px; }
    .native-share-btn:hover { background: #2563eb; }

    .library-link {
      background:white; border:2px solid #2563eb; padding:15px; text-align:center; border-radius:10px; margin:15px 0;
    }
    .library-link a {
      background: linear-gradient(135deg,#8bc34a,#3498db); color:white; padding:10px 20px; text-decoration:none; border-radius:8px; font-weight:600; display:inline-block;
    }
    .library-link a:hover { background: linear-gradient(135deg,#7cb342,#2980b9); }

    .nav-buttons { text-align:center; margin:15px 0; }
    .nav-buttons button { margin: 0 10px 10px 10px; }

    .hidden { display:none; }

    .archive-day {
      padding: 15px; margin: 10px 0; background: white; border: 2px solid #e5e7eb; border-radius: 10px; cursor:pointer;
      display:flex; justify-content:space-between; align-items:center;
    }
    .archive-day:hover { border-color:#2563eb; }
    .archive-day.played { border-color:#16a34a; background:#f0fdf4; }

    .archive-info h4 { margin:0 0 5px 0; color:#1f2937; }
    .archive-book { font-size:.9rem; color:#6b7280; margin:0; }
    .archive-status { font-size:1.5rem; }

    .countdown-section {
      text-align:center; padding:15px; border-top:1px solid #e5e7eb; margin-top:20px;
      background: linear-gradient(135deg, rgba(139,195,74,.05), rgba(52,152,219,.05));
      border-radius: 8px;
    }
    .countdown-display { font-size:1rem; font-weight:600; color:#1f2937; }

    @media (max-width:600px) {
      body { padding:15px; }
      h1 { font-size:2.2rem; }
      .stats-row { flex-direction: column; align-items: center; gap: 8px; }
      .stats-container, .theme-hint { min-width: 280px; margin: 5px 0; }
      .nav-buttons button { display:block; width:100%; margin:8px 0; padding: 15px; }
      .input-group { flex-direction: column; gap: 10px; }
      .input-group input { width: 100%; padding: 15px; }
      .submit-btn, .skip-btn { width: 100%; padding: 15px; }
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>üìö Checked Out</h1>
    <p class="subtitle">Daily Book Guessing Game</p>
    <div class="date-info">
      <div class="game-number" id="gameNumber">Game #001</div>
      <div id="currentDate">Loading...</div>
    </div>
  </div>

  <div class="stats-row">
    <div class="stats-container">
      <div class="streak-display">üî• <span id="streakCount">0</span> day streak</div>
    </div>
    <div class="theme-hint" id="themeHint">üìñ Loading theme...</div>
  </div>

  <div class="nav-buttons">
    <button id="todayBtn">üìÖ Today's Game</button>
    <button id="archiveBtn">üóÇÔ∏è Archive</button>
  </div>

  <div id="gameSection">
    <div class="container">
      <h3>üìã Clues (<span id="clueCount">1</span>/6)</h3>
      <div id="cluesContainer"></div>
    </div>

    <div class="container" id="inputSection">
      <h3>Your Guess</h3>
      <div class="input-group">
        <input type="text" id="guessInput" placeholder="Enter book title...">
        <button class="submit-btn" id="submitBtn">‚Üí</button>
        <button class="skip-btn" id="skipBtn">‚úï</button>
      </div>
    </div>

    <div class="container hidden" id="guessesSection">
      <h3>Your Guesses (<span id="guessCount">0</span>/6)</h3>
      <div id="guessesContainer"></div>
    </div>

    <div class="container hidden" id="resultSection">
      <div id="resultText"></div>
      
      <div class="stats-summary">
        <div class="stat-item">
          <div class="stat-number" id="gamesPlayed">0</div>
          <div class="stat-label">Played</div>
        </div>
        <div class="stat-item">
          <div class="stat-number" id="winPercent">0%</div>
          <div class="stat-label">Win %</div>
        </div>
        <div class="stat-item">
          <div class="stat-number" id="currentStreak">0</div>
          <div class="stat-label">Current Streak</div>
        </div>
        <div class="stat-item">
          <div class="stat-number" id="maxStreak">0</div>
          <div class="stat-label">Max Streak</div>
        </div>
      </div>
      
      <div style="text-align:center;">
        <button class="native-share-btn" id="nativeShareBtn" style="display:none;">üì§ Share</button>
        <button class="share-button" id="shareBtn">üìã Copy Results</button>
      </div>
      
      <div class="library-link">
        <p><strong>üìñ Find this book at Southold Free Library</strong></p>
        <a href="#" id="catalogLink" target="_blank">Search Our Catalog</a>
      </div>
    </div>
  </div>

  <div class="container hidden" id="archiveSection">
    <h3>üóÇÔ∏è Game Archive</h3>
    <div id="archiveList"></div>
  </div>

  <div class="countdown-section">
    <div class="countdown-display">‚è∞ Next game in: <span id="countdownTime">--:--:--</span></div>
  </div>

  <div style="text-align:center; padding:15px; color:#6b7280; font-size:14px;">
    <p style="margin:0;">Powered by <a href="https://southoldlibrary.org" target="_blank" style="color:#3498db; text-decoration:none; font-weight:600;">Southold Free Library</a></p>
  </div>

<script>
const gameData = {
  books: [
    {
      date: "2025-08-21",
      title: "NINETEEN EIGHTY-FOUR",
      author: "George Orwell",
      theme: "Dystopian Fiction",
      clues: [
        "In a surveillance state where Big Brother watches all",
        "Author: British author, Orwell", 
        "Published: 1949",
        "Themes: Totalitarianism, surveillance, truth manipulation, individual freedom",
        "Setting: Dystopian London under constant government monitoring",
        "Character: Winston Smith"
      ]
    },
    {
      date: "2025-08-22",
      title: "THE GREAT GATSBY",
      author: "F. Scott Fitzgerald", 
      theme: "American Literature",
      clues: [
        "Tobey Maguire played Nick in the 2013 film adaptation",
        "The green light symbolizes unreachable desire",
        "Set in the glittering Jazz Age",
        "Entered public domain in 2021", 
        "A 1925 novel about chasing the American Dream",
        "Main character: Jay Gatsby"
      ]
    },
    {
      date: "2025-08-23",
      title: "THE 48 LAWS OF POWER",
      author: "Robert Greene",
      theme: "Self-Help", 
      clues: [
        "A numbered guide to mastering influence",
        "Uses stories of Napoleon, Cleopatra, Sun Tzu",
        "The most banned book in U.S. prisons",
        "Published in 1998, still a bestseller",
        "Known as the 'Machiavellian Bible'",
        "Author: Robert Greene"
      ]
    },
    {
      date: "2025-08-24",
      title: "EVERYTHING IS TUBERCULOSIS", 
      author: "John Green",
      theme: "Nonfiction",
      clues: [
        "A 2025 nonfiction book about TB (infectious disease)",
        "Blends medical history with personal reflections",
        "Explores the world's oldest bacterial disease", 
        "Written by John Green (The Fault in Our Stars)",
        "Connects science, humor, and humanity",
        "Narrator: John Green"
      ]
    },
    {
      date: "2025-08-25",
      title: "TO KILL A MOCKINGBIRD",
      author: "Harper Lee",
      theme: "Social Justice",
      clues: [
        "A trial divides a small Alabama town",
        "Narrated by Scout Finch",
        "Explores justice, innocence, and prejudice",
        "Won the Pulitzer Prize in 1961", 
        "Frequently challenged in schools",
        "Character: Atticus Finch"
      ]
    }
  ],
  
  currentBook: null,
  guesses: [],
  cluesShown: 1,
  gameOver: false,
  selectedDate: null,
  gameHistory: {},
  playerStats: {
    streak: 0,
    gamesPlayed: 0, 
    gamesWon: 0,
    maxStreak: 0,
    lastPlayDate: null
  }
};

function getTodayNY() {
  return new Date().toLocaleDateString('en-CA', {timeZone: 'America/New_York'});
}

function getTodaysBook() {
  const targetDate = gameData.selectedDate || getTodayNY();
  const book = gameData.books.find(b => b.date === targetDate);
  if (book) return book;
  
  const dayNum = Math.max(1, Math.floor((new Date() - new Date('2025-08-21')) / 86400000) + 1);
  const index = (dayNum - 1) % gameData.books.length;
  return gameData.books[index];
}

function updateDisplay() {
  gameData.currentBook = getTodaysBook();
  
  const today = gameData.selectedDate ? new Date(gameData.selectedDate + 'T12:00:00') : new Date();
  document.getElementById('currentDate').textContent = today.toLocaleDateString('en-US', {
    timeZone: 'America/New_York',
    weekday: 'long', 
    year: 'numeric',
    month: 'long', 
    day: 'numeric'
  });
  
  const dayNum = gameData.selectedDate ? 
    gameData.books.findIndex(b => b.date === gameData.selectedDate) + 1 :
    Math.max(1, Math.floor((new Date() - new Date('2025-08-21')) / 86400000) + 1);
  
  document.getElementById('gameNumber').textContent = 'Game #' + String(dayNum).padStart(3, '0');
  document.getElementById('themeHint').textContent = 'üìñ ' + gameData.currentBook.theme;
  document.getElementById('streakCount').textContent = gameData.playerStats.streak;
}

function showClues() {
  const container = document.getElementById('cluesContainer');
  container.innerHTML = '';
  
  for (let i = 0; i < gameData.cluesShown; i++) {
    if (gameData.currentBook.clues[i]) {
      const clueDiv = document.createElement('div');
      clueDiv.className = 'clue';
      clueDiv.textContent = gameData.currentBook.clues[i];
      container.appendChild(clueDiv);
    }
  }
  
  document.getElementById('clueCount').textContent = gameData.cluesShown;
}

function displayGuesses() {
  const container = document.getElementById('guessesContainer');
  const section = document.getElementById('guessesSection');
  
  if (gameData.guesses.length === 0) {
    section.classList.add('hidden');
    return;
  }
  
  section.classList.remove('hidden');
  container.innerHTML = '';
  
  gameData.guesses.forEach(guess => {
    const div = document.createElement('div');
    div.className = 'guess ' + (guess.isSkip ? 'skipped' : (guess.correct ? 'correct' : 'incorrect'));
    div.textContent = guess.text;
    container.appendChild(div);
  });
  
  document.getElementById('guessCount').textContent = gameData.guesses.length;
}

function normalizeTitle(str) {
  return str.toUpperCase()
    .replace(/[^\w\s]/g, ' ')
    .replace(/\s+/g, ' ')
    // Remove common articles and prepositions
    .replace(/\b(THE|A|AN|TO|OF|AND|IN|ON|AT|BY|FOR|WITH|FROM|IS|ARE|WAS|WERE)\b/g, '')
    // Number conversions - written to numeric
    .replace(/\bONE\b/g, '1').replace(/\b1\b/g, 'ONE')
    .replace(/\bTWO\b/g, '2').replace(/\b2\b/g, 'TWO')
    .replace(/\bTHREE\b/g, '3').replace(/\b3\b/g, 'THREE')
    .replace(/\bFOUR\b/g, '4').replace(/\b4\b/g, 'FOUR')
    .replace(/\bFIVE\b/g, '5').replace(/\b5\b/g, 'FIVE')
    .replace(/\bSIX\b/g, '6').replace(/\b6\b/g, 'SIX')
    .replace(/\bSEVEN\b/g, '7').replace(/\b7\b/g, 'SEVEN')
    .replace(/\bEIGHT\b/g, '8').replace(/\b8\b/g, 'EIGHT')
    .replace(/\bNINE\b/g, '9').replace(/\b9\b/g, 'NINE')
    .replace(/\bTEN\b/g, '10').replace(/\b10\b/g, 'TEN')
    .replace(/\bELEVEN\b/g, '11').replace(/\b11\b/g, 'ELEVEN')
    .replace(/\bTWELVE\b/g, '12').replace(/\b12\b/g, 'TWELVE')
    .replace(/\bTHIRTEEN\b/g, '13').replace(/\b13\b/g, 'THIRTEEN')
    .replace(/\bFOURTEEN\b/g, '14').replace(/\b14\b/g, 'FOURTEEN')
    .replace(/\bFIFTEEN\b/g, '15').replace(/\b15\b/g, 'FIFTEEN')
    .replace(/\bSIXTEEN\b/g, '16').replace(/\b16\b/g, 'SIXTEEN')
    .replace(/\bSEVENTEEN\b/g, '17').replace(/\b17\b/g, 'SEVENTEEN')
    .replace(/\bEIGHTEEN\b/g, '18').replace(/\b18\b/g, 'EIGHTEEN')
    .replace(/\bNINETEEN\b/g, '19').replace(/\b19\b/g, 'NINETEEN')
    .replace(/\bTWENTY\b/g, '20').replace(/\b20\b/g, 'TWENTY')
    .replace(/\bTHIRTY\b/g, '30').replace(/\b30\b/g, 'THIRTY')
    .replace(/\bFORTY\b/g, '40').replace(/\b40\b/g, 'FORTY')
    .replace(/\bFIFTY\b/g, '50').replace(/\b50\b/g, 'FIFTY')
    .replace(/\bSIXTY\b/g, '60').replace(/\b60\b/g, 'SIXTY')
    .replace(/\bSEVENTY\b/g, '70').replace(/\b70\b/g, 'SEVENTY')
    .replace(/\bEIGHTY\b/g, '80').replace(/\b80\b/g, 'EIGHTY')
    .replace(/\bNINETY\b/g, '90').replace(/\b90\b/g, 'NINETY')
    .replace(/\bHUNDRED\b/g, '100').replace(/\b100\b/g, 'HUNDRED')
    .replace(/\bTHOUSAND\b/g, '1000').replace(/\b1000\b/g, 'THOUSAND')
    // Special book-specific conversions
    .replace(/\bNINETEEN EIGHTY FOUR\b/g, '1984').replace(/\b1984\b/g, 'NINETEEN EIGHTY FOUR')
    .replace(/\bFORTY EIGHT\b/g, '48').replace(/\b48\b/g, 'FORTY EIGHT')
    .replace(/\bFIFTY SHADES\b/g, '50 SHADES').replace(/\b50 SHADES\b/g, 'FIFTY SHADES')
    .replace(/\bONE HUNDRED YEARS\b/g, '100 YEARS').replace(/\b100 YEARS\b/g, 'ONE HUNDRED YEARS')
    .replace(/\bTWENTY THOUSAND LEAGUES\b/g, '20000 LEAGUES').replace(/\b20000 LEAGUES\b/g, 'TWENTY THOUSAND LEAGUES')
    .replace(/\bFAHRENHEIT FOUR HUNDRED FIFTY ONE\b/g, 'FAHRENHEIT 451').replace(/\bFAHRENHEIT 451\b/g, 'FAHRENHEIT FOUR HUNDRED FIFTY ONE')
    .replace(/\bCATCH TWENTY TWO\b/g, 'CATCH 22').replace(/\bCATCH 22\b/g, 'CATCH TWENTY TWO')
    .replace(/\bTWO THOUSAND ONE\b/g, '2001').replace(/\b2001\b/g, 'TWO THOUSAND ONE')
    // Clean up extra spaces
    .replace(/\s+/g, ' ')
    .trim();
}

function makeGuess() {
  if (gameData.gameOver) return;
  
  const input = document.getElementById('guessInput');
  const guess = input.value.trim();
  if (!guess) return;
  
  const correct = normalizeTitle(guess) === normalizeTitle(gameData.currentBook.title);
  gameData.guesses.push({text: guess, correct: correct, isSkip: false});
  
  input.value = '';
  displayGuesses();
  
  if (correct) {
    endGame(true);
  } else {
    if (gameData.cluesShown < 6) {
      gameData.cluesShown++;
      showClues();
    }
    if (gameData.guesses.length >= 6) {
      endGame(false);
    }
  }
}

function skipClue() {
  if (gameData.gameOver) return;
  
  gameData.guesses.push({text: 'Skipped clue ' + gameData.cluesShown, correct: false, isSkip: true});
  gameData.cluesShown = Math.min(gameData.cluesShown + 1, 6);
  
  displayGuesses();
  showClues();
  
  if (gameData.guesses.length >= 6) {
    endGame(false);
  }
}

function endGame(won) {
  gameData.gameOver = true;
  document.getElementById('inputSection').classList.add('hidden');
  document.getElementById('resultSection').classList.remove('hidden');
  
  const actualGuesses = gameData.guesses.filter(g => !g.isSkip).length;
  const resultText = won ? 
    '<div class="result win"><h3>Congratulations!</h3><p>You guessed "<strong>' + gameData.currentBook.title + '</strong>" by ' + gameData.currentBook.author + ' in ' + actualGuesses + ' guess' + (actualGuesses === 1 ? '' : 'es') + '!</p></div>' :
    '<div class="result lose"><h3>Better luck next time!</h3><p>The book was "<strong>' + gameData.currentBook.title + '</strong>" by ' + gameData.currentBook.author + '</p></div>';
  
  document.getElementById('resultText').innerHTML = resultText;
  
  updateStats(won);
  updateEndGameDisplay();
  
  const searchQuery = (gameData.currentBook.title + ' ' + gameData.currentBook.author).replace(/[^\w\s]/g, ' ').trim();
  document.getElementById('catalogLink').href = 'https://southold-suffc.na.iiivega.com/search?query=' + encodeURIComponent(searchQuery);
}

function updateStats(won) {
  const today = getTodayNY();
  const isToday = !gameData.selectedDate || gameData.selectedDate === today;
  
  if (isToday && gameData.playerStats.lastPlayDate !== today) {
    gameData.playerStats.gamesPlayed++;
    gameData.playerStats.lastPlayDate = today;
    
    if (won) {
      gameData.playerStats.gamesWon++;
      gameData.playerStats.streak++;
      gameData.playerStats.maxStreak = Math.max(gameData.playerStats.maxStreak, gameData.playerStats.streak);
    } else {
      gameData.playerStats.streak = 0;
    }
    
    localStorage.setItem('checkedout-stats', JSON.stringify(gameData.playerStats));
  }
}

function updateEndGameDisplay() {
  document.getElementById('gamesPlayed').textContent = gameData.playerStats.gamesPlayed;
  document.getElementById('winPercent').textContent = gameData.playerStats.gamesPlayed > 0 ? 
    Math.round((gameData.playerStats.gamesWon / gameData.playerStats.gamesPlayed) * 100) + '%' : '0%';
  document.getElementById('currentStreak').textContent = gameData.playerStats.streak;
  document.getElementById('maxStreak').textContent = gameData.playerStats.maxStreak;
}

function shareResults() {
  const dayNum = Math.max(1, Math.floor((new Date() - new Date('2025-08-21')) / 86400000) + 1);
  const actualGuesses = gameData.guesses.filter(g => !g.isSkip).length;
  const won = gameData.gameOver && gameData.guesses.some(g => g.correct);
  
  let result = 'Checked Out #' + dayNum + ' ' + (won ? actualGuesses + '/6 üìö' : 'X/6 üìö') + '\n\n';
  
  gameData.guesses.forEach(g => {
    result += g.isSkip ? '‚è≠Ô∏è' : (g.correct ? 'üü¢' : 'üî¥');
  });
  
  result += '\n\nPlay at: https://shelf-life-beta.vercel.app';
  
  if (navigator.share) {
    navigator.share({title: 'Checked Out #' + dayNum, text: result}).catch(() => copyToClipboard(result));
  } else {
    copyToClipboard(result);
  }
}

function copyToClipboard(text) {
  navigator.clipboard.writeText(text).then(() => {
    const btn = document.getElementById('shareBtn');
    const original = btn.textContent;
    btn.textContent = '‚úÖ Copied!';
    setTimeout(() => btn.textContent = original, 2000);
  });
}

function showToday() {
  gameData.selectedDate = null;
  resetGame();
  initGame();
  document.getElementById('gameSection').classList.remove('hidden');
  document.getElementById('archiveSection').classList.add('hidden');
}

function showArchive() {
  document.getElementById('gameSection').classList.add('hidden');
  document.getElementById('archiveSection').classList.remove('hidden');
  populateArchive();
}

function populateArchive() {
  const container = document.getElementById('archiveList');
  container.innerHTML = '';
  
  const today = getTodayNY();
  
  gameData.books.forEach((book, index) => {
    if (book.date <= today) {
      const dayNum = index + 1;
      const played = gameData.gameHistory[book.date];
      
      const div = document.createElement('div');
      div.className = 'archive-day ' + (played ? 'played' : 'unplayed');
      
      const dateParts = book.date.split('-');
      const months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
      const dateStr = months[parseInt(dateParts[1])-1] + ' ' + parseInt(dateParts[2]) + ', ' + dateParts[0];
      
      const bookText = (played && (played.won || played.completed)) ? 
        book.title + ' by ' + book.author : 
        book.theme;
      
      const info = document.createElement('div');
      info.className = 'archive-info';
      info.innerHTML = '<h4>Game #' + dayNum + ' - ' + dateStr + '</h4><p class="archive-book">' + bookText + '</p>';
      
      const status = document.createElement('div');
      status.className = 'archive-status';
      status.textContent = played && played.won ? '‚úÖ ' + (played.guesses?.filter(g => !g.isSkip).length || 0) + '/6' :
                          played && played.completed ? '‚ùå' : '‚ö™';
      
      div.appendChild(info);
      div.appendChild(status);
      
      div.onclick = function() {
        gameData.selectedDate = book.date;
        resetGame();
        initGame();
        document.getElementById('gameSection').classList.remove('hidden');
        document.getElementById('archiveSection').classList.add('hidden');
      };
      
      container.appendChild(div);
    }
  });
}

function resetGame() {
  gameData.guesses = [];
  gameData.cluesShown = 1;
  gameData.gameOver = false;
  document.getElementById('guessesSection').classList.add('hidden');
  document.getElementById('resultSection').classList.add('hidden');
  document.getElementById('inputSection').classList.remove('hidden');
  document.getElementById('guessInput').value = '';
}

function updateCountdown() {
  const now = new Date();
  const tomorrow = new Date(now);
  tomorrow.setDate(tomorrow.getDate() + 1);
  tomorrow.setHours(0, 0, 0, 0);
  
  const diff = tomorrow - now;
  const hours = Math.floor(diff / 3600000);
  const minutes = Math.floor((diff % 3600000) / 60000);
  const seconds = Math.floor((diff % 60000) / 1000);
  
  document.getElementById('countdownTime').textContent = 
    String(hours).padStart(2, '0') + ':' + 
    String(minutes).padStart(2, '0') + ':' + 
    String(seconds).padStart(2, '0');
}

function loadSavedData() {
  try {
    const savedStats = localStorage.getItem('checkedout-stats');
    if (savedStats) {
      gameData.playerStats = {...gameData.playerStats, ...JSON.parse(savedStats)};
    }
    
    const savedHistory = localStorage.getItem('checkedout-history');
    if (savedHistory) {
      gameData.gameHistory = JSON.parse(savedHistory);
    }
  } catch (e) {
    console.log('No saved data');
  }
}

function loadGameState() {
  const key = gameData.selectedDate || getTodayNY();
  const saved = gameData.gameHistory[key];
  
  if (saved) {
    gameData.guesses = saved.guesses || [];
    gameData.cluesShown = saved.cluesShown || 1;
    gameData.gameOver = saved.gameOver || false;
    
    displayGuesses();
    showClues();
    
    if (gameData.gameOver) {
      setTimeout(() => endGame(saved.won), 100);
    }
  } else {
    showClues();
  }
}

function saveGameState(won) {
  const key = gameData.selectedDate || getTodayNY();
  gameData.gameHistory[key] = {
    guesses: [...gameData.guesses],
    cluesShown: gameData.cluesShown,
    gameOver: gameData.gameOver,
    completed: gameData.gameOver,
    won: won || false
  };
  localStorage.setItem('checkedout-history', JSON.stringify(gameData.gameHistory));
}

function initGame() {
  loadSavedData();
  updateDisplay();
  loadGameState();
  
  if (navigator.share) {
    document.getElementById('nativeShareBtn').style.display = 'inline-block';
  }
}

document.addEventListener('DOMContentLoaded', function() {
  document.getElementById('todayBtn').onclick = showToday;
  document.getElementById('archiveBtn').onclick = showArchive;
  document.getElementById('submitBtn').onclick = makeGuess;
  document.getElementById('skipBtn').onclick = skipClue;
  document.getElementById('shareBtn').onclick = shareResults;
  document.getElementById('nativeShareBtn').onclick = shareResults;
  
  document.getElementById('guessInput').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') makeGuess();
  });
  
  // Update countdown every second
  updateCountdown();
  setInterval(updateCountdown, 1000);
  
  // Initialize the game
  initGame();
});
</script>
</body>
</html>
